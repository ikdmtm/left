# 技術/仕様の決定ログ

## 1. “月”は平均月で統一
- 理由：カレンダー月差分は月末や閏年で表示が揺れ、UXが不安定

## 2. 活動時間は「起床/睡眠推定」ではなく固定レンジ
- 理由：睡眠推定は個人差/実装負荷が高い。MVPは「今日の残り活動時間」を直感的に出すことを優先

## 3. 保存は AsyncStorage のみ
- 理由：バックエンド無し・オフライン前提。同期は将来検討

## 4. Expo SDK 54 へアップグレード (2026-01-28)
- 理由：Expo Go SDK 54がリリースされ、SDK 51はサポート外になったため
- 変更内容：
  - Expo SDK: 51.0.0 → 54.0.0
  - React: 18.2.0 → 19.1.0
  - React Native: 0.74.5 → 0.81.5
  - expo-router: 3.5.0 → 6.0.22
  - TypeScript: 5.3.3 → 5.9.2
  - tsconfig.json の moduleResolution を "bundler" に変更
  - --legacy-peer-deps を使用してインストール（React 19の互換性対応）
- 影響：Expo Go最新版で動作可能に

## 5. UI改善（初回フィードバック対応）(2026-01-28)
- 実施した変更：
  - 「残り（目安）」→「残りの時間」に変更
  - 画面タイトル「Time Left」→「Home」、「Settings」→「設定」に変更
  - YYMMDD切り替えボタンを削除（不要な表示形式）
  - 人生バーに進捗に応じた色を追加（0-50%: 緑、50-75%: 黄色、75-100%: 赤）
  - 設定画面で値が編集できないバグを修正（useFocusEffectで毎回読み込み + editable={true}を明示）
  - 「今日の1行」→「今日の1行メモ」、「今週の1行」→「今週の1行メモ」に変更
  - メモ欄の説明文を改善（目標や日記に使えることを明示）
- 後続で検討する項目：
  - 生年月日入力の改善（ハイフン入力の手間を削減）→ M2で対応済み
  - 1行メモの履歴表示機能（過去の記録を見れるようにする）→ M3で対応予定

## 6. M2品質改善の実施 (2026-01-28)
- 実施した変更：
  - 生年月日入力を8桁数字入力に改善（自動でYYYY-MM-DD形式に整形）
    - 入力例：20000101 → 自動で 2000-01-01 に変換
    - keyboardType="numeric"で数字キーボードを表示
    - プレースホルダーと説明文を追加
  - 到達予定日時の表示を見やすく改善
    - 変更前：2080-01-01 12:34:56
    - 変更後：2080年1月1日 12:34
  - 設定画面のラベルと説明文を改善
    - 「活動時間 start」→「活動開始時刻」
    - 「活動時間 end」→「活動終了時刻」
    - 各入力欄に親切な説明文を追加（平均寿命の参考値、起床・就寝時刻の説明）
  - 設定画面の編集可能性を確実に
    - useFocusEffectの依存配列を空にして最適化
    - すべてのTextInputにeditable={true}を明示的に追加
- 時間フォーマットの桁区切りは既に実装済み（toLocaleString使用）

## 7. 設定画面をモーダルピッカー形式に改善 (2026-01-28)
- 理由：フォーマットに合わせる入力ストレスを完全に排除
- 第1版の問題点：
  - インラインピッカーは背景が白で見づらい
  - 画面が縦に長くなりすぎる
  - UIが前のバージョンより見づらい
- 第2版の改善（モーダル形式）：
  - 入力フォームをタップすると、モーダル（ダイアログ）でピッカーを表示
  - 背景をグレー（#f9f9f9）に変更して視認性向上
  - 各入力ボックスは白背景で枠線付き、タップ可能に
  - モーダルは半透明の背景（rgba(0,0,0,0.5)）で表示
  - ピッカー自体はグレー背景（#f5f5f5）で見やすく
  - 完了ボタンでモーダルを閉じる
- 実施した変更：
  - 生年月日：年・月・日のタップ可能なボックス → モーダルで選択
    - 年：1900-2020年の範囲
    - 月：1-12月
    - 日：1-31日
  - 寿命の目安：タップ可能なボックス → モーダルで選択
    - 1-150歳の範囲（ユーザー要望で1歳から選択可能に）
    - 説明文に男女別の平均寿命を追加：「男性 81.5歳、女性 87.6歳」
  - 活動開始時刻：時・分のタップ可能なボックス → モーダルで選択
    - 時：0-23時
    - 分：0-55分（5分刻み）
  - 活動終了時刻：時・分のタップ可能なボックス → モーダルで選択
  - 1行メモのデフォルト：選択式ボタン
    - アクティブ時は青色の枠と背景色を表示
  - 注意書き「本アプリは統計上の目安です...」を削除
    - ユーザーフィードバック：明らかにだますようなアプリではないので不要
- 使用パッケージ：@react-native-picker/picker
- UIの改善：
  - ScrollViewで全体をスクロール可能に
  - 背景色：グレー（#f9f9f9）
  - 入力ボックス：白背景、グレー枠線、角丸8px
  - モーダル背景：半透明黒（rgba(0,0,0,0.5)）
  - ピッカー背景：グレー（#f5f5f5）
  - 保存ボタン：青色（#007AFF）
  - より見やすく、タップしやすいデザインに統一
